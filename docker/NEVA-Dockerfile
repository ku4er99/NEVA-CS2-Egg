# Dockerfile with SteamRT3
FROM        registry.gitlab.steamos.cloud/steamrt/sniper/platform:latest-container-runtime-depot
LABEL       author="ku4er99 (forked from K4ryuu @ KitsuneLab)" \
            maintainer="ku4er99@gmail.com" \
            org.opencontainers.image.description="The SteamRT3 Platform image for Pterodactyl/Pelican CS2 servers is packed with numerous features, designed to simplify server management and reduce hassle." \
            org.opencontainers.image.source="https://github.com/ku4er99/NEVA-CS2-Egg"

# Prep OS
RUN         mkdir -p /etc/sudoers.d && \
            echo "%sudo ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/flatdeb && \
            chmod 0440 /etc/sudoers.d/flatdeb

ENV         DEBIAN_FRONTEND=noninteractive
RUN         apt update && \
            apt install -y --no-install-recommends \
              iproute2 jq unzip rsync curl ca-certificates python3 && \
            rm -rf /var/lib/apt/lists/*

# Create directories and copy files
RUN         mkdir -p /scripts /utils
COPY        ./scripts /scripts/
COPY        ./utils /utils/
COPY        ./entrypoint.sh /entrypoint.sh

# Set permissions (read-only + executable)
RUN         chmod 555 /scripts/*.sh && \
            chmod 555 /scripts/updaters/*.sh && \
            chmod 555 /utils/*.sh && \
            chmod 555 /entrypoint.sh

USER        container
ENV         USER=container HOME=/home/container
WORKDIR     /home/container

CMD         [ "/bin/bash", "/entrypoint.sh" ]